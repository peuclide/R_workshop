{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Great Lakes Harvest Data\"\nauthor: \"Peter Euclide\"\ndate: \"July 6, 2018\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(XLConnect)\nlibrary(knitr)\n\nErie <-  readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 1)\nOntario <- readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 2)\nHuron <-  readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 3)\nSuperior <- readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 4)\nMichigan <- readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 5)\nSt.Clair <- readWorksheetFromFile(\"GLcommercialData.xls\", sheet = 6)\n\n```\n\n#gather() function (tidyr)\nmost plotting with ggplot works best with long dataframes, to convert a wide data frame to long you can use the gather function. \n\nthe sytax is fairly simple, \"key\" refers to the name of the new column that is currently represented by multiple columns. In this data set columns the columns we are interested address the harvest at each site in the lake. \"value\" referst to the new column name where the numbers we are interested will go, in this case the actual harvest. Finally, we subtract out all of the additional explanitory columns, in this case, Species, Lake, Year, Comments and SurfaceAreaAcres. \n\n```{r}\nErie_long <- Erie %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\nHuron_long <- Huron %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\nMichigan_long <- Michigan %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\nOntario_long <- Ontario %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\nSuperior_long <- Superior %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\nSt.Clair_long <- St.Clair %>% gather(key = Site, value = harvest, -c(Species, Lake, Year, Comments, SurfaceAreaAcres))\n\n#### rbind everything into a single datasheet\nGL_data <- rbind(Erie_long, Huron_long, Michigan_long, Ontario_long, Superior_long, St.Clair_long)\nGL_data$harvest <- as.numeric(GL_data$harvest)\n\n\n```\n\n```{r}\n#### use dplyr to summarize top 5 species across the great lakes\n\ntop_reports <- GL_data %>% group_by(Lake) %>% count(Species) %>% top_n(5)\nhead(top_reports)\n\ntop_harvest <- GL_data %>% group_by(Lake, Species) %>% \n  summarise(All_harvest = sum(harvest, na.rm = T),\n            Mean_harvest = mean(harvest, na.rm = T),\n            SD_harvest = sd(harvest, na.rm = T)) %>% \n  top_n(5)\n\n\n```\n\n# inserting tables into a report\n\nIf you want a table in the report you can add it with kable() function\n\n```{r create table}\n\ncolumn_names <- c(\"Lake\", \"Species\", \"Total Harvest (Lbs)\", \"Mean Harvest (Lbs)\", \"Standard Deviation\")\ntable_caption <- \"this is a table summarizing harvest in the Great Lakes.\"\n\nkable(top_harvest, digits = 2, col.names = column_names, caption = table_caption)\n\n```\n\n\n```{r}\n\nggplot(top_reports, aes(Lake, y = n, fill = Species))+\n  geom_bar(stat = \"identity\")+\n  theme_classic()+\n  theme(legend.position = 'bottom')\n\nggplot(top_harvest, aes(Lake, y = All_harvest, fill = Species))+\n  geom_bar(stat = \"identity\")+\n  theme_classic()+\n  theme(legend.position = 'bottom')\n\n# facet_grid\nggplot(top_harvest, aes(Species, y= All_harvest))+\n  facet_grid(.~Lake)+\n  geom_bar(stat = \"identity\")+\n  theme_classic()+\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_text(angle = 90, hjust =1))\n\nggplot(top_harvest, aes(Lake, y= All_harvest))+\n  facet_wrap(~Species)+\n  geom_bar(stat = \"identity\")+\n  theme_classic()+\n  theme(legend.position = \"bottom\",\n        axis.text.x = element_text(angle = 90, hjust =1))\n```\n\n# harvest of Lake whitefish by lake\n\nWe can use dplyr to again summarize data, and then plot the subsequent summary\n\n```{r}\n# summarize data\nwh_by_year <- GL_data %>% filter(Species == \"Lake Whitefish\") %>%\n  group_by(Lake, Year) %>%\n  summarize(Total_catch = sum(harvest, na.rm = T),\n            Mean_catch = mean(harvest, na.rm = T),\n            SD_catch = sd(harvest, na.rm = T))\n\n# now plot the summary\nggplot(wh_by_year, aes(y = Mean_catch, x = Year, color = Lake))+\n  geom_line()\n```\n\n\n## orrrrrrrr\n\nwe can combine dplyr and ggplot and pipe directly into the figure\n\n```{r}\n\nGL_data %>% filter(Species == \"Lake Whitefish\") %>%\n  group_by(Lake, Year) %>%\n  summarize(Total_catch = sum(harvest, na.rm = T),\n            Mean_catch = mean(harvest, na.rm = T),\n            SD_catch = sd(harvest, na.rm = T)) %>% \n  ggplot(aes(y = Mean_catch, x = Year, color = Lake))+\n  geom_line()\n  \n```\n\n\n```{r}\n\n\n```\n\n",
    "created" : 1530923389507.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3581528611",
    "id" : "2375F189",
    "lastKnownWriteTime" : 1531949876,
    "last_content_update" : 1531949876770,
    "path" : "~/Documents/OneDrive/Documents/UWSP_Larson_2018/projects/R_workshop/GL_harvest_examples.Rmd",
    "project_path" : "GL_harvest_examples.Rmd",
    "properties" : {
        "last_setup_crc32" : "35278108aa10d389",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}